# NESTED TMUX CONFIG
# This config is for nested tmux sessions (on separate -L nested socket)
# First load the base config, then override specific settings

# Source the base tmux config
source-file ~/.tmux.conf

# Enable extended keys for Ctrl+Alt+Shift and other modifier combinations
# Note: This is inherited from base config but we set it again to be explicit
set-option -s extended-keys always

# Update environment variables when attaching
set-option -g update-environment "OUTER_TMUX_WINDOW"

# Override: Use C-M-S-Arrow to move windows (since C-M-Arrow is captured by outer tmux)
bind-key -n C-M-S-Left run-shell "tmux-swap-or-move-window :-1"
bind-key -n C-M-S-Right run-shell "tmux-swap-or-move-window :+1"
bind-key -n C-M-S-Up run-shell "tmux-swap-or-move-window :-1"
bind-key -n C-M-S-Down run-shell "tmux-swap-or-move-window :+1"

# Override: Reload nested config (not base config)
bind r source-file ~/.tmux.nested.conf \; display-message "Nested config reloaded!"

# Override: Blue status bar to distinguish from outer tmux
set -g status-style bg=colour27,fg=colour137
set -g status-right '#[fg=colour233,bg=colour241,bold] NESTED %Y-%m-%d #[fg=colour233,bg=colour245,bold] %H:%M:%S '

# Override: Cyan current window to distinguish from outer tmux
setw -g window-status-current-style fg=black,bg=cyan

# Fix: Make copy mode work properly in nested tmux
# Escape should exit copy mode (not just clear selection)
bind-key -T copy-mode-vi Escape send-keys -X cancel
# Enter should copy selection and exit
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "reattach-to-user-namespace pbcopy"
# Space to start selection (if not already bound)
bind-key -T copy-mode-vi Space send-keys -X begin-selection
# v to start selection (vi-style)
bind-key -T copy-mode-vi v send-keys -X begin-selection
# y to copy and exit
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "reattach-to-user-namespace pbcopy"
