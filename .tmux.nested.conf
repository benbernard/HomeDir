# NESTED TMUX CONFIG
# Settings specific to nested tmux sessions (on separate -L nested socket).
# Sources shared config first, then adds nested-only overrides.

source-file ~/.tmux.shared.conf

# Unbind keys that belong to outer tmux only.
# tmux source-file is additive — stale bindings from old configs survive reloads.
unbind-key -n C-M-Left
unbind-key -n C-M-Right
unbind-key -n C-M-Up
unbind-key -n C-M-Down
unbind-key -n C-o

# Update environment variables when attaching
set-option -g update-environment "OUTER_TMUX_WINDOW"

# Window movement: C-M-S-Arrow (since C-M-Arrow is captured by outer tmux)
# Requires Ghostty keybinds to send the right escape sequences (see ~/.config/ghostty/config)
bind-key -n C-M-S-Left run-shell "tmux-swap-or-move-window :-1 #{pane_id}"
bind-key -n C-M-S-Right run-shell "tmux-swap-or-move-window :+1 #{pane_id}"
bind-key -n C-M-S-Up run-shell "tmux-swap-or-move-window :-1 #{pane_id}"
bind-key -n C-M-S-Down run-shell "tmux-swap-or-move-window :+1 #{pane_id}"

# Reload nested config
bind r source-file ~/.tmux.nested.conf \; display-message "Nested config reloaded!"

######################
### NESTED STYLING ###
######################
# Catppuccin Macchiato — Blue accent for nested tmux
# Mantle bg (#1e2030) is slightly darker than outer's Base bg (#24273a)

# Double status bar with animated rainbow separator
set -g status 2
set -g status-interval 1
set -g status-style bg=#1e2030,fg=#cad3f5
set -g status-format[1] '#(tmux-rainbow-bar)'
set -g status-right '#[fg=#494d64,bg=#1e2030]#[fg=#8bd5ca,bg=#494d64] NESTED #[fg=#5b6078,bg=#494d64]#[bg=#5b6078] #[fg=#ed8796,bg=#5b6078]%Y#[fg=#f5a97f]-#[fg=#eed49f]%m#[fg=#a6da95]-#[fg=#8bd5ca]%d #[fg=#8aadf4,bg=#5b6078]#[bg=#8aadf4] #[fg=#24273a,bg=#8aadf4,bold]%H#[fg=#24273a]:#[fg=#24273a]%M#[fg=#24273a]:#[fg=#24273a]%S '
set -g status-left-length 30

# Blue pill for current window
setw -g window-status-current-format '#[bg=#1e2030] #[fg=#8aadf4]#[fg=#24273a,bg=#8aadf4,bold] #I #W #[fg=#8aadf4,bg=#1e2030] '

# Inactive window pills (use Mantle bg for outer edges)
setw -g window-status-format '#[bg=#1e2030] #[fg=#363a4f]#[fg=#a5adcb,bg=#363a4f] #I #W #[fg=#363a4f,bg=#1e2030] '

# Active pane border: Blue
set -g pane-active-border-style bg=default,fg=#8aadf4
