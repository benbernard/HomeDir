# NESTED TMUX CONFIG
# This config is for nested tmux sessions (on separate -L nested socket)
# First load the base config, then override specific settings

# Source the base tmux config
source-file ~/.tmux.conf

# Ensure mouse is on in nested tmux (also set in base config)
set-option -g mouse on

# Enable extended keys for Ctrl+Alt+Shift and other modifier combinations
# Note: This is inherited from base config but we set it again to be explicit
set-option -s extended-keys always

# Update environment variables when attaching
set-option -g update-environment "OUTER_TMUX_WINDOW"

# Override: Use C-M-S-Arrow to move windows (since C-M-Arrow is captured by outer tmux)
bind-key -n C-M-S-Left run-shell "tmux-swap-or-move-window :-1"
bind-key -n C-M-S-Right run-shell "tmux-swap-or-move-window :+1"
bind-key -n C-M-S-Up run-shell "tmux-swap-or-move-window :-1"
bind-key -n C-M-S-Down run-shell "tmux-swap-or-move-window :+1"

# Override: Reload nested config (not base config)
bind r source-file ~/.tmux.nested.conf \; display-message "Nested config reloaded!"

# Override: Catppuccin Macchiato with Blue accent to distinguish from outer (Green)
# Mantle bg (#1e2030) is slightly darker than outer's Base bg (#24273a)
set -g status 2
set -g status-style bg=#1e2030,fg=#cad3f5
set -g status-format[1] '#[fg=#ed8796,bg=#1e2030]━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━#[fg=#f5a97f,bg=#1e2030]━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━#[fg=#eed49f,bg=#1e2030]━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━#[fg=#a6da95,bg=#1e2030]━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━#[fg=#8bd5ca,bg=#1e2030]━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━#[fg=#8aadf4,bg=#1e2030]━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━#[fg=#c6a0f6,bg=#1e2030]━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━#[fg=#f5bde6,bg=#1e2030]━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━#[fg=#ed8796]━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━#[fg=#f5a97f]━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━#[fg=#eed49f]━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━#[fg=#a6da95]━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━#[fg=#8bd5ca]━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━#[fg=#8aadf4]━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━#[fg=#c6a0f6]━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━#[fg=#f5bde6]━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━'
set -g status-right '#[fg=#494d64,bg=#1e2030]#[fg=#8bd5ca,bg=#494d64] NESTED #[fg=#5b6078,bg=#494d64]#[bg=#5b6078] #[fg=#ed8796,bg=#5b6078]%Y#[fg=#f5a97f]-#[fg=#eed49f]%m#[fg=#a6da95]-#[fg=#8bd5ca]%d #[fg=#8aadf4,bg=#5b6078]#[bg=#8aadf4] #[fg=#24273a,bg=#8aadf4,bold]%H#[fg=#24273a]:#[fg=#24273a]%M#[fg=#24273a]:#[fg=#24273a]%S '

# Override: Blue pill for current window
setw -g window-status-current-format '#[bg=#1e2030] #[fg=#8aadf4]#[fg=#24273a,bg=#8aadf4,bold] #I #W #[fg=#8aadf4,bg=#1e2030] '

# Override: Inactive window pills (use Mantle bg for outer edges)
setw -g window-status-format '#[bg=#1e2030] #[fg=#363a4f]#[fg=#a5adcb,bg=#363a4f] #I #W #[fg=#363a4f,bg=#1e2030] '

# Override: Pane active border uses Blue instead of Green
set -g pane-active-border-style bg=default,fg=#8aadf4

# Fix: Make copy mode work properly in nested tmux
# Escape should exit copy mode (not just clear selection)
bind-key -T copy-mode-vi Escape send-keys -X cancel
# Enter should copy selection to system clipboard and exit
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "pbcopy"
# Space to start selection (if not already bound)
bind-key -T copy-mode-vi Space send-keys -X begin-selection
# v to start selection (vi-style)
bind-key -T copy-mode-vi v send-keys -X begin-selection
# y to copy to system clipboard and exit
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
# Mouse drag release copies to system clipboard
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"
