#!/bin/sh

# Get current window index and ID
current_idx=$(tmux display-message -p '#{window_index}')
current_window=$(tmux display-message -p '#{window_id}')

# Get all window indices, sorted
all_windows=$(tmux list-windows -F '#{window_index}' | sort -n)

# Parse direction (:-1 = left, :+1 = right)
direction="$1"

if [ "$direction" = ":-1" ]; then
    # Moving LEFT: find the window immediately to our left and swap with it
    target_idx=""

    for idx in $all_windows; do
        if [ "$idx" -lt "$current_idx" ]; then
            target_idx="$idx"  # Keep updating to get the closest one to our left
        fi
    done

    if [ -z "$target_idx" ]; then
        # Already at leftmost position, do nothing
        exit 0
    fi

elif [ "$direction" = ":+1" ]; then
    # Moving RIGHT: find the window immediately to our right and swap with it
    target_idx=""
    found_current=0

    for idx in $all_windows; do
        if [ "$found_current" -eq 1 ] && [ -z "$target_idx" ]; then
            target_idx="$idx"
            break
        fi
        if [ "$idx" -eq "$current_idx" ]; then
            found_current=1
        fi
    done

    if [ -z "$target_idx" ]; then
        # Already at rightmost position, do nothing
        exit 0
    fi

else
    # Absolute index provided - use swap behavior
    target_idx="$1"
fi

# Swap windows and keep focus on our window
tmux swap-window -s "$current_idx" -t "$target_idx"
# After swap, our content is now at target_idx, so select it
tmux select-window -t "$target_idx"
