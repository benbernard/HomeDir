#!/usr/bin/env python3
"""Rainbow gradient bar for tmux nested status line.

Generates a smooth HSV rainbow of box-drawing characters.
Accepts optional width argument (passed from tmux as #{client_width}).
"""
import sys
import time


def hsv_to_rgb(h, s, v):
    c = v * s
    x = c * (1 - abs((h / 60) % 2 - 1))
    m = v - c
    if h < 60:    r, g, b = c, x, 0
    elif h < 120: r, g, b = x, c, 0
    elif h < 180: r, g, b = 0, c, x
    elif h < 240: r, g, b = 0, x, c
    elif h < 300: r, g, b = x, 0, c
    else:         r, g, b = c, 0, x
    return int((r + m) * 255), int((g + m) * 255), int((b + m) * 255)


# Width comes from tmux #{client_width} or defaults to 500
WIDTH = int(sys.argv[1]) if len(sys.argv) > 1 else 500
SPEED = 0             # positions shifted per second (0 = static)
CYCLES = 2.0          # rainbow repetitions across the bar
SATURATION = 0.8
VALUE = 0.9

offset = time.time() * SPEED

# bg is omitted â€” status-style bg=#1e2030 already sets the background,
# which cuts format string size by ~40% and reduces rendering load
# through the outer tmux's VT100 emulator.
parts = []
for i in range(WIDTH):
    hue = ((i + offset) * CYCLES * 360.0 / WIDTH) % 360
    r, g, b = hsv_to_rgb(hue, SATURATION, VALUE)
    parts.append(f"#[fg=#{r:02x}{g:02x}{b:02x}]\u2501")

sys.stdout.write("".join(parts))
