# OUTER TMUX CONFIG
# Settings specific to the outer (top-level) tmux session.
# Sources shared config first, then adds outer-only bindings and styling.

source-file ~/.tmux.shared.conf

# Unbind keys that belong to nested tmux only.
# tmux source-file is additive — it never removes bindings. Without explicit
# unbinds, stale bindings from old configs survive server restarts and reloads,
# causing the outer tmux to intercept keys meant for nested tmux.
unbind-key -n C-M-S-Left
unbind-key -n C-M-S-Right
unbind-key -n C-M-S-Up
unbind-key -n C-M-S-Down

# Window movement: C-M-Arrow moves window in the window list (outer only)
# These intercept keys before nested tmux sees them.
bind-key -n C-M-Left run-shell "tmux-swap-or-move-window :-1 #{pane_id}"
bind-key -n C-M-Right run-shell "tmux-swap-or-move-window :+1 #{pane_id}"
bind-key -n C-M-Up run-shell "tmux-swap-or-move-window :-1 #{pane_id}"
bind-key -n C-M-Down run-shell "tmux-swap-or-move-window :+1 #{pane_id}"

# Send prefix (C-x) to nested tmux: press C-o without prefix
# C-x C-o and C-x o both send literal C-o to terminal
bind-key -n C-o send-prefix
bind-key C-o send-keys C-o
bind-key o send-keys C-o

# File/dir pickers (uses tmux-fzf-picker script)
# run-shell expands #{} formats before passing to the binary
bind-key -n M-p   run-shell "tmux-fzf-picker pick -t f -d '#{pane_current_path}' -p '#{pane_id}'"
bind-key -n M-P   run-shell "tmux-fzf-picker pick -t d -d '#{pane_current_path}' -p '#{pane_id}'"
bind-key -n M-h   run-shell "tmux-fzf-picker pick -t f -d '$HOME' -p '#{pane_id}' --no-ignore --exclude repos"
bind-key -n M-H   run-shell "tmux-fzf-picker pick -t d -d '$HOME' -p '#{pane_id}' --no-ignore --exclude repos"
bind-key -n M-r   run-shell "tmux-fzf-picker pick -t d -d '$HOME/repos' -p '#{pane_id}' --no-ignore --no-toggles --prefix '~/repos/'"
bind-key -n M-R   run-shell "tmux-fzf-picker pick -t f -d '$HOME/repos' -p '#{pane_id}' --no-ignore --no-toggles --prefix '~/repos/'"

# Reload outer config
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

######################
### OUTER STYLING ####
######################
# Catppuccin Macchiato — Green accent for outer tmux

# Status bar
set -g status-position bottom
set -g status on
set -g status-style bg=#24273a,fg=#cad3f5
set -g status-right-length 60
set -g status-right '#[fg=#494d64,bg=#24273a]#[bg=#494d64] #[fg=#ed8796,bg=#494d64]%Y#[fg=#f5a97f]-#[fg=#eed49f]%m#[fg=#a6da95]-#[fg=#8bd5ca]%d #[fg=#a6da95,bg=#494d64]#[bg=#a6da95] #[fg=#24273a,bg=#a6da95,bold]%H#[fg=#24273a]:#[fg=#24273a]%M#[fg=#24273a]:#[fg=#24273a]%S '
set -g status-left-length 30

# Current window tab (Green pill)
setw -g window-status-current-format '#[bg=#24273a] #[fg=#a6da95]#[fg=#24273a,bg=#a6da95,bold] #I #W #[fg=#a6da95,bg=#24273a] '

# Inactive window tabs (Surface0 pill)
setw -g window-status-format '#[bg=#24273a] #[fg=#363a4f]#[fg=#a5adcb,bg=#363a4f] #I #W #[fg=#363a4f,bg=#24273a] '

# Active pane border: Green
set -g pane-active-border-style bg=default,fg=#a6da95

# source site if present
if-shell '[[ -e ~/site/tmux.conf ]]' \
  'source ~/site/tmux.conf'
