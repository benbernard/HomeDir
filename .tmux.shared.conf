# SHARED TMUX CONFIG
# Settings common to both outer and nested tmux sessions.
# Sourced by both ~/.tmux.conf and ~/.tmux.nested.conf

# Enable extended keys for Ctrl+Alt+Shift and other modifier combinations
set-option -s extended-keys always

# Allow window titling from escape codes
set-option -g allow-rename on

# Use Different prefix keys
set-option -g prefix C-x
bind-key x send-prefix
bind-key C-x last-window

unbind-key C-b # unbind default prefix key

# Terminal type configuration
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",xterm-256color:Tc"
# Ensure Ghostty terminal is recognized for SGR extended mouse and true color
set -sa terminal-features 'xterm-ghostty:mouse:RGB'

# Increase scrollback size
set-option -g history-limit 10000

# Let windows in sessions be different sizes
set-option -g aggressive-resize on

# Enable mouse support (click to select panes, scroll, resize pane borders, etc.)
# Toggle mouse on/off with prefix + M
set-option -g mouse on
bind-key M set-option -g mouse \; display-message "mouse #{?mouse,on,off}"

# Bind standard screen keys
bind-key 'C-]' paste-buffer
bind-key C-n next-window
bind-key C-p previous-window
bind-key 'C-[' copy-mode
bind-key ' ' next-window
bind-key 'Tab' select-pane -t :.+
bind-key 'K' confirm-before -p "kill-window #W? (y/n)" kill-window

# split panes using | and -
bind | split-window -h
bind - split-window -v
unbind '"'
unbind %

# bind vim movement keys
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

# Toggle multiplex input
bind-key s set-window-option synchronize-panes\; display-message "synchronize-panes is now #{?pane_synchronized,on,off}"

# Bind kill pane to q
bind q kill-pane
bind '#' display-panes # re-bind display-panes to prefix #

# Fix C-enter to accept zsh suggestion
bind-key -n C-Enter send-keys "\e[27;5;13~"

# Better settings for vi copy mode
setw -g mode-keys vi

# Cmd+C via Ghostty: CSI 99;9~ (see ~/.config/ghostty/config)
# Register as user-key, then bind in copy-mode and root
set -s user-keys[0] "\e[99;9~"
bind-key -T copy-mode-vi User0 send-keys -X copy-pipe-and-cancel "pbcopy"
bind-key -n User0 send-keys C-c

# "type faster", per cmyers@
set -s escape-time 0

bind-key 'Q' kill-pane -a # Kill all but this pane mapping

# Bind m to move a window to existing index (swap-or-move)
bind-key m command-prompt -p 'Move to window:' "run-shell \"tmux-swap-or-move-window '%%'\""

# Bind 'i' to fix irc panes.  Use in primary pane, switches to next, sizes it
# to 20, switches back.
bind-key i select-pane -t :.+ \; resize-pane -x 20 \;  select-pane -t :.+

# tmux messages are displayed for 4 seconds
set -g display-time 4000

# Renumber windows to remove gaps
bind R run-shell "ic tmux renumber"

######################
### Plugins ##########
######################

# List of plugins
# plugin manager
set -g @plugin 'tmux-plugins/tpm'

# better search
set -g @plugin 'tmux-plugins/tmux-copycat'

# tmux-yank: https://github.com/tmux-plugins/tmux-yank
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @override_copy_command 'pbcopy'
set -g @yank_selection_mouse 'clipboard'

######################
### SHARED STYLING ###
######################
# Catppuccin Macchiato palette — shared base styling

## Status bar design
set -g status-justify left
set -g status-interval 2
set -g window-status-separator ''

# Copy/selection mode
setw -g mode-style fg=#24273a,bg=#c6a0f6,bold

# Info on left
set -g status-left ' '

# Quiet
set-option -g visual-activity off
set-option -g visual-bell off
set-option -g visual-silence off
set-window-option -g monitor-activity off
set-option -g bell-action none

# Clock
setw -g clock-mode-colour '#c6a0f6'

# Pane styling (inactive border — same for both)
set -g pane-border-style bg=default,fg=#494d64

# Visual bell info
setw -g window-status-bell-style fg=#24273a,bg=#ed8796,bold

# Message styling
set -g message-style fg=#24273a,bg=#f5a97f,bold
set -g message-command-style fg=#cad3f5,bg=#363a4f

# Initialize TMUX plugin manager (keep this line at the very bottom of shared config)
run '~/.tmux/plugins/tpm/tpm'
